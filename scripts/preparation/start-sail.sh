#!/bin/bash

# ============================================
# Laravel Sailèµ·å‹•ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
# ============================================
# Laravel Sailã‚³ãƒ³ãƒ†ãƒŠã®èµ·å‹•ç¢ºèªã¨èµ·å‹•ã‚’è¡Œã†
# ============================================

set -e

echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "ğŸ³ Laravel Sailèµ·å‹•ç¢ºèª"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"

# Sailã‚³ãƒ³ãƒ†ãƒŠã®çŠ¶æ…‹ç¢ºèª
if ./vendor/bin/sail ps | grep -q "Up"; then
  echo "âœ… Laravel Sailã¯æ—¢ã«èµ·å‹•ã—ã¦ã„ã¾ã™"
  echo ""
  ./vendor/bin/sail ps
  echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
  exit 0
fi

echo "â³ Laravel Sailã‚’èµ·å‹•ã—ã¦ã„ã¾ã™..."
echo ""

# Sailã‚³ãƒ³ãƒ†ãƒŠèµ·å‹•
./vendor/bin/sail up -d

# èµ·å‹•å®Œäº†ã¾ã§å¾…æ©Ÿ
echo "â³ ã‚³ãƒ³ãƒ†ãƒŠã®èµ·å‹•ã‚’å¾…æ©Ÿä¸­..."
sleep 5

# èµ·å‹•ç¢ºèª
if ./vendor/bin/sail ps | grep -q "Up"; then
  echo ""
  echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
  echo "âœ… Laravel SailãŒèµ·å‹•ã—ã¾ã—ãŸ"
  echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
  echo ""
  ./vendor/bin/sail ps
  echo ""
  echo "æ³¨æ„:"
  echo "  - ä»¥é™ã®ã™ã¹ã¦ã®PHP/Composerã‚³ãƒãƒ³ãƒ‰ã¯ ./vendor/bin/sail çµŒç”±ã§å®Ÿè¡Œ"
  echo "  - ã‚³ãƒ³ãƒ†ãƒŠåœæ­¢: ./vendor/bin/sail down"
  exit 0
else
  echo ""
  echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
  echo "âŒ Laravel Sailã®èµ·å‹•ã«å¤±æ•—ã—ã¾ã—ãŸ"
  echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
  echo ""
  echo "å¯¾å‡¦æ–¹æ³•:"
  echo "  1. Docker DesktopãŒèµ·å‹•ã—ã¦ã„ã‚‹ã‹ç¢ºèª"
  echo "  2. ãƒãƒ¼ãƒˆç«¶åˆã‚’ç¢ºèª: lsof -i :80"
  echo "  3. æ‰‹å‹•ã§èµ·å‹•: ./vendor/bin/sail up -d"
  exit 1
fi
