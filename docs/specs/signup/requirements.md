# 要件定義書: 新規登録機能

## 機能概要

新規登録機能は、新しいユーザーがシステムにアカウントを作成するための機能です。3ステップのウィザード形式(入力 → 確認 → 完了)で、ユーザーが安心して登録できる仕組みを提供します。

**関連要件ID**: REQ-1-1(ユーザー登録)

**スコープ外**:
- ログイン・ログアウト機能 → `login/requirements.md` 参照
- パスワードリセット機能 → `user-password-reset/requirements.md` 参照
- プロフィール管理機能(将来実装予定)
- プロフィール画像アップロード・管理機能(将来実装予定)

## 要件

### 要件1: ユーザー登録(REQ-1-1)

**ユーザーストーリー**: 動画配信プラットフォームを利用したい人として、メールアドレスと名前とパスワードで簡単にアカウントを作成し、すぐに動画視聴を開始したい。

#### 受け入れ基準

**ステップ1: 情報入力(/signup)**
1. ユーザーが登録フォームで必須項目を入力すると、システムは入力内容を検証する
   - 名前(必須、2-255文字)
   - メールアドレス(必須、メールアドレス形式、255文字以下)
   - 電話番号(任意、半角数字0始まり10-11桁、ハイフンなし)
   - パスワード(必須、8-255文字、英字と数字を各1文字以上含む)
   - パスワード確認(必須、パスワードと一致)
   - 利用規約同意(必須)

2. メールアドレスが既に登録済みの場合、「このメールアドレスは既に登録されています。」とエラーを表示する

3. パスワードが条件を満たさない場合、「パスワードは英字と数字を含む8文字以上で入力してください。」とエラーを表示する

4. 電話番号はフロントエンドで全角数字を半角数字に自動変換する(onBlurイベント)

5. 検証が成功すると、入力内容をセッションに保存し、確認画面にリダイレクトする

**ステップ2: 入力内容確認(/signup/confirm)**
1. セッションに保存された情報を表示する(名前、メールアドレス、電話番号)
   - パスワードは表示しない(セキュリティ)

2. 「戻る」ボタンで登録画面に戻ると、入力データを保持する(パスワードを除く)
   - 名前、メールアドレス、電話番号はoldセッションから復元
   - パスワードは再入力必須

3. 「登録する」ボタンで登録を確定する

**ステップ3: 登録完了(/signup/complete)**
1. パスワードをBcryptでハッシュ化して保存する
2. ユーザーに「一般ユーザー」権限を付与する
3. 自動ログイン後、登録完了画面を表示する
4. 「ログイン画面へ」ボタンでログイン画面にリダイレクトする

**セキュリティ要件**:
1. 確認画面・完了画面への直接アクセスは拒否し、登録画面にリダイレクトする
2. ログイン済みユーザーが登録画面にアクセスした場合、ダッシュボードにリダイレクトする
3. パスワードは平文でセッションに保存しない(ハッシュ化してから保存)

## 非機能要件

全体的な非機能要件(性能、セキュリティ、信頼性)については [tech.md](../../steering/tech.md) を参照。

### この機能固有の制約

- **入力データの保持**: 確認画面から戻った際、パスワード以外の入力データを保持する
- **電話番号の自動変換**: 全角数字を半角数字に自動変換し、ユーザビリティを向上させる
- **バリデーション**: フロントエンドとバックエンド両方でバリデーションを実施する
