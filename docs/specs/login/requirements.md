# 要件定義書: ログイン機能

## 機能概要

ログイン機能は、登録済みユーザーがシステムにアクセスするための認証・認可を実現します。ユーザーは安全にログイン・ログアウトでき、セッション管理により一定時間後の自動ログアウトも実現します。

**関連要件ID**: REQ-1-2(ログイン・ログアウト)

**スコープ外**:
- ユーザー登録機能 → `signup/requirements.md` 参照
- パスワードリセット機能 → `user-password-reset/requirements.md` 参照
- プロフィール管理機能(将来実装予定)

## 要件

### 要件1: ログイン・ログアウト(REQ-1-2)

**ユーザーストーリー**: 登録済みユーザーとして、メールアドレスとパスワードでログインし、使用後は確実にログアウトしたい。

#### 受け入れ基準

**ログイン**:
1. メールアドレスとパスワードで認証する
2. 認証失敗時は「メールアドレスまたはパスワードが正しくありません」とエラーを表示する
3. 認証成功時はセッション(有効期限24時間)を作成し、ダッシュボードへリダイレクトする
4. ダッシュボードには「ようこそ、{ユーザー名}さん」とユーザー名を右上に表示する

**ログアウト**:
1. ログアウトボタンクリックでセッションを破棄する
2. ログアウト後はログイン画面へリダイレクトする
3. ログアウト後に保護された画面にアクセスすると、ログイン画面にリダイレクトする

### 要件2: 権限管理

**ユーザーストーリー**: 管理者として、動画管理画面や統計情報画面にアクセスし、一般ユーザーにはアクセスを制限したい。

#### 受け入れ基準

1. ユーザー登録時はデフォルトで「一般ユーザー」権限を付与する
2. 管理者専用画面にアクセス時は管理者権限を確認する
3. 一般ユーザーが管理者専用画面にアクセスすると、前の画面にリダイレクトする(権限エラーメッセージは表示しない)

### 要件3: セッション管理

**ユーザーストーリー**: セキュリティを重視するユーザーとして、一定時間操作をしなかった場合は自動的にログアウトしてほしい。

#### 受け入れ基準

1. ログイン時はセッションの有効期限を24時間に設定する
2. ユーザーが操作を行うとセッションの有効期限を更新する
3. セッションの有効期限が切れると、次回アクセス時にログイン画面にリダイレクトする

## 非機能要件

全体的な非機能要件(性能、セキュリティ、信頼性)については [tech.md](../../steering/tech.md) を参照。

### この機能固有の制約

- **総当たり攻撃対策**: 同一IPアドレスからのログイン試行は5回まで、その後15分間ロック
- **ログ出力**: 認証失敗・成功、権限エラーをログに記録(ユーザーID、IPアドレスを含む)
