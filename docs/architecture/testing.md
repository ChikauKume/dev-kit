# テスト戦略

## TDD原則

### Red → Green → Refactor サイクル

1. **Red（失敗）**: 実装前にテストを書く → テストが失敗する
2. **Green（成功）**: テストを通すための最小限の実装 → テストが成功する
3. **Refactor（改善）**: テストを保ったままコードを改善

## テスト比率

### 正常系 vs 異常系
- **正常系**: 30-40%
- **異常系**: 60-70%

**理由**: エッジケースとエラーハンドリングの方が重要

### テストの粒度

| テスト種別 | 対象 | 目的 | 実行速度 |
|----------|------|------|---------|
| Unit | Domain/Application層 | ビジネスロジック単体 | 高速 |
| Feature | Presentation層 | HTTPリクエスト/レスポンス | 中速 |
| E2E | 完全なユーザーフロー | 統合動作確認 | 低速 |

## PHPUnitテスト

### Unitテスト
**対象**: Domain層、Application層
**目的**: ビジネスロジックの単体テスト

**例**:
- ValueObject のバリデーション
- Entity のメソッド
- UseCase のロジック

### Featureテスト
**対象**: Presentation層
**目的**: HTTPリクエスト/レスポンスの統合テスト

**例**:
- Controller のエンドポイント
- FormRequest のバリデーション
- データベース連携

## E2Eテスト（Playwright）

### 目的
完全なユーザーフローの統合動作確認

### テストシナリオ分類
- **正常系**: 期待通りの操作フロー
- **異常系**: エラーハンドリング、バリデーションエラー

### 記録
- **video**: on（実行記録を自動保存）
- **slowMo**: 750ms（動作確認用スロー再生）

## モック/スタブ戦略

### Unitテスト
- 外部依存は全てモック
- Repository はインターフェースをモック

### Featureテスト
- データベースは実際に使用（テスト用DB）
- 外部API はモック

### E2Eテスト
- 全て実環境で実行
- モック不使用

## カバレッジ目標

- **Domain/Application層**: 90%以上
- **Infrastructure層**: 80%以上
- **Presentation層**: 80%以上

## テストデータ管理

### ファクトリー使用
- Laravel Factoryでテストデータ生成
- シード不使用（テストの独立性保証）

### データベースリセット
- 各テスト実行前にデータベースをリセット
- トランザクション使用（高速化）
